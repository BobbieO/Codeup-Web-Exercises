<!DOCTYPE html>
<html>
<head>
    <title>Weather Map</title>
    <meta charset="utf-8">
    
    <!-- font -->
    <!-- <link href= ### rel='stylesheet' type='text/css'> -->

    <!-- my stylesheet -->
    <link rel="stylesheet" href="/css/weather_map.css">

</head>
<body>

<h1 class="main-heading"><span class="inner-text">Weather Map</span></h1>

<!-- div to hold map -->
<div id="map-canvas"></div>

<button id="dropBtn">Get Weather</button>

<div class="weather-block">
    <h2 id="city"></h2>
    <div id="forecast">
    </div>
</div>
  
<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpmOh_cyHuMA_gbjEA1s860RFWqmg26Bc"></script>

<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

<script type="text/javascript">
(function(){
"use strict";

 // Set our map options
    var mapOptions = {
        // Set the zoom level
        zoom: 10,

        // This sets the center start point of the map before being dragged
        center: {
                lat: 29.425656,
                lng: -98.484984
            },
    };

    // Render the map
    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

    var marker = new google.maps.Marker({
        position: mapOptions.center,
        map: map,
        draggable: true,
        animation: google.maps.Animation.DROP
    });

    // listener to create draggable marker that registers end position
    marker.addListener("dragend", function(data) {

        // variable to store lat/long of marker
        var myPosition = {lat: data.latLng.lat(), lng: data.latLng.lng()};
        var weatherInfo = '';
        
        // ajax to request info from weather map place
        $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
            APPID: "7231b1576575e9f61aa70771f8cb8571",
            lat: myPosition.lat,
            lon: myPosition.lng,
            units: "imperial",
            cnt: 3
        }).done(function(data) {
            console.log(data);

            $("#forecast").html("");

            $("#city").html(data.city.name);

            data.list.forEach(function(element, index){
                var weatherInfo = '';

                weatherInfo += "<div class='forcast'>"
                weatherInfo += "<h3 class='temp'>" + element.temp.max + "</h3>";
                weatherInfo += "<img src='http://openweathermap.org/img/w/" + element.weather[0].icon + ".png'>";
                weatherInfo += "<p class='weather'>" + element.weather[0].main + ": " + element.weather[0].description + "</p>";
                weatherInfo += "<p>" + element.humidity + "</p>";
                weatherInfo += "<p>" + element.speed + "</p>";
                weatherInfo += "</div>";

            $("#forecast").append(weatherInfo);
            });
        });

    });
      




})();
</script>
</body>
</html>

